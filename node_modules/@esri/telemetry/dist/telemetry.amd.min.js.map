{"version":3,"file":"telemetry.amd.min.js","sources":["../src/amazon/auth.js","../src/amazon/format-telemetry-attributes.js","../src/amazon/format-telemetry-metrics.js","../src/amazon/create-event-log.js","../src/amazon/create-page-view-log.js","../src/google/map-metrics-and-dimensions.js","../src/google/index.js","../src/helpers/storage.js","../src/amazon/index.js","../src/helpers/crypto.js","../src/helpers/anonymize.js","../src/helpers/internal-orgs.js","../src/helpers/telemetry-enabled.js","../src/index.js"],"sourcesContent":["import Storage from '../helpers/storage'\n\nconst COGNITO_KEY = 'TELEMETRY_COGNITO_CREDENTIALS'\n\nexport function getCredentials (IdentityPoolId, options = {}) {\n  const fipsSubdomainSuffix = options.fips === true ? '-fips' : ''\n  const COGNITO_URL = `https://cognito-identity${fipsSubdomainSuffix}.us-east-1.amazonaws.com/`\n  let cached = Storage.get(COGNITO_KEY)\n  if (cached && Date.now() / 1000 < cached.Expiration) return Promise.resolve(cached)\n\n  const fetchOptions = {\n    method: 'POST',\n    headers: {\n      'Content-type': 'application/x-amz-json-1.1',\n      'X-Amz-Target': 'AWSCognitoIdentityService.GetId'\n    },\n    body: JSON.stringify({ IdentityPoolId })\n  }\n\n  return fetch(COGNITO_URL, fetchOptions)\n    .then(response => {\n      if (!response.ok) {\n        throw new Error(response.statusText)\n      }\n      return response.json()\n    })\n    .then((response) => {\n      const { IdentityId } = response\n      const options = {\n        method: 'POST',\n        headers: {\n          'Content-type': 'application/x-amz-json-1.1',\n          'X-Amz-Target': 'AWSCognitoIdentityService.GetCredentialsForIdentity'\n        },\n        body: JSON.stringify({ IdentityId })\n      }\n      return fetch(COGNITO_URL, options)\n    })\n    .then(response => {\n      if (!response.ok) {\n        throw new Error(response.statusText)\n      }\n      return response.json()\n    })\n    .then(({ Credentials }) => {\n      Storage.set(COGNITO_KEY, Credentials)\n      return Credentials\n    })\n}\n","export default function formatTelemetryAttributes ({ telemetryData, dimensionLookup = {}, excludeKeys = [] }) {\n  return Object.keys(telemetryData)\n    .filter(key => {\n      return !excludeKeys.includes(key)\n    })\n    .map(key => {\n      if (dimensionLookup[key]) {\n        return {\n          key: getCustomDimensionKey(dimensionLookup, key),\n          value: telemetryData[key] }\n      }\n\n      return {\n        key,\n        value: getValue(telemetryData, key)\n      }\n    })\n    .reduce((acc, { key, value }) => {\n      acc[key] = value\n      return acc\n    }, {});\n}\n\nfunction getValue (data, key) {\n  if (key === 'json') {\n    return data[key] ? JSON.stringify(data[key]) : 'null'\n  }\n  \n  return data[key] === undefined ? 'null' : data[key].toString()\n}\n\nfunction getCustomDimensionKey (lookup, key) {\n  return `dimension${lookup[key]}`\n}","const METRICS = ['size', 'duration', 'position', 'number', 'count']\n\nexport default function formatTelemetryMetrtics (telemetryData, metricLookup = {}) {\n  return Object.keys(telemetryData).filter(key => {\n    return metricLookup[key] || METRICS.includes(key)\n  }).map(key => {\n    if (metricLookup[key]) {\n      return {\n        key: getCustomMetricKey(metricLookup, key),\n        value: telemetryData[key]\n      }\n    }\n\n    return {\n      key,\n      value: telemetryData[key]\n    }\n  }).reduce((acc, { key, value }) => {\n    acc[key] = value\n    return acc\n  }, {});\n}\n\nfunction getCustomMetricKey (lookup, key) {\n  return `metric${lookup[key]}`\n}\n","import formatTelemetryAttributes from './format-telemetry-attributes'\nimport formatTelemetryMetrics from './format-telemetry-metrics'\n\nexport default function createEventLog ({\n  event = {},\n  dimensionLookup = {},\n  metricLookup = {}\n}) {\n  const { eventType = 'other' } = event\n  const metrics = formatTelemetryMetrics(event, metricLookup)\n  const eventAttributes = formatTelemetryAttributes({\n    telemetryData: { eventType, ...event },\n    dimensionLookup,\n    excludeKeys: ['workflow', ...Object.keys(metrics), ...Object.keys(metricLookup)]\n  })\n\n  return {\n    name: eventType,\n    attributes: {\n      referrer: document.referrer,\n      hostname: window.location.hostname,\n      path: window.location.pathname,\n      ...eventAttributes\n    },\n    metrics\n  }\n}\n","import formatTelemetryAttributes from './format-telemetry-attributes'\nimport formatTelemetryMetrics from './format-telemetry-metrics'\n\nexport default function createPageViewLog ({\n  page,\n  previousPage = {},\n  options = {},\n  dimensionLookup = {},\n  metricLookup = {}\n}) {\n  const metrics = formatTelemetryMetrics(options, metricLookup)\n  const attributes = formatTelemetryAttributes({\n    telemetryData: options,\n    dimensionLookup,\n    excludeKeys: ['workflow', ...Object.keys(metrics), ...Object.keys(metricLookup)]\n  })\n\n  const { referrer, title } = document || {}\n  const { hostname, pathname } = window && window.location ? window.location : {}\n\n  return {\n    name: 'pageView',\n    attributes: {\n      referrer,\n      hostname,\n      path: page || pathname,\n      pageUrl: page || pathname,\n      pageName: title,\n      previousPageUrl: previousPage.pageUrl,\n      previousPageName: previousPage.pageName,\n      ...attributes\n    },\n    metrics\n  }\n}\n\n","export default function mapMetricsAndDimensions ({\n  customTelemetryData = {},\n  dimensionLookup = {},\n  metricLookup = {}\n}) {\n  return Object.keys(customTelemetryData).map(function (key) {\n    if (dimensionLookup[key]) {\n      return {\n        key: getCustomDimensionKey(dimensionLookup, key),\n        value: customTelemetryData[key] }\n    }\n    if (metricLookup[key]) {\n      return {\n        key: getCustomMetricKey(metricLookup, key),\n        value: customTelemetryData[key]\n      }\n    }\n  })\n  .filter(val => val)\n  .reduce((acc, { key, value }) => {\n    acc[key] = value\n    return acc\n  }, {})\n}\n\nfunction getCustomDimensionKey (lookup, key) {\n  return `dimension${lookup[key]}`\n}\n\nfunction getCustomMetricKey (lookup, key) {\n  return `metric${lookup[key]}`\n}\n","import mapCustomMetricsAndDimensions from './map-metrics-and-dimensions'\n\nexport default class Google {\n  constructor (options = {}) {\n    this.name = 'google'\n    Object.assign(this, options)\n  }\n\n  logPageView (page, options) {\n    const pageviewObj = buildPageViewObject(page, options, this.dimensions, this.metrics)\n    getTrackers((trackers) => {\n      trackers.forEach((tracker) => {\n        tracker.send(pageviewObj)\n      })\n    })\n  }\n\n  logEvent (event) {\n    const eventObject = buildEventObject(event, this.dimensions, this.metrics)\n    getTrackers(trackers => {\n      trackers.forEach(tracker => {\n        tracker.send(eventObject)\n      })\n    })\n  }\n}\n\nfunction getTrackers (callback) {\n  if (window.ga) {\n    window.ga(() => {\n      callback(window.ga.getAll())\n    })\n  } else {\n    console.log(new Error('Google Analytics trackers not available'))\n  }\n}\nfunction buildPageViewObject (page, options, dimensions = {}, metrics = {}) {\n  const standardTelemetry = {\n    hitType: 'pageview',\n    page: page || window.location.pathname\n  }\n\n  const mappedCustomTelemetryData = mapCustomMetricsAndDimensions({\n    customTelemetryData: options,\n    dimensionLookup: dimensions,\n    metricLookup: metrics\n  })\n\n  return Object.assign({}, standardTelemetry, mappedCustomTelemetryData)\n}\n\nfunction buildEventObject (event, dimensions = {}, metrics = {}) {\n  const standardTelemetryData = {\n    hitType: 'event',\n    eventCategory: event.category || 'none',\n    eventAction: event.action,\n    eventLabel: event.label\n  }\n\n  const mappedCustomTelemetryData = mapCustomMetricsAndDimensions({\n    customTelemetryData: event,\n    dimensionLookup: dimensions,\n    metricLookup: metrics })\n  return Object.assign({}, standardTelemetryData, mappedCustomTelemetryData)\n}\n","export default {\n  storage: {},\n  memory: true,\n  get (key) {\n    let stored\n    try {\n      stored = (window.localStorage && window.localStorage.getItem(key)) || this.storage[key]\n    } catch (e) {\n      stored = this.storage[key]\n    }\n    if (stored) {\n      try {\n        return JSON.parse(stored)\n      } catch (e) {\n        return undefined\n      }\n    } else {\n      return undefined\n    }\n  },\n  set (key, value) {\n    // handle Safari private mode (setItem is not allowed)\n    value = JSON.stringify(value)\n    try {\n      window.localStorage.setItem(key, value)\n    } catch (e) {\n      if (!this.memory) {\n        console.error('setting local storage failed, falling back to in-memory storage')\n        this.memory = true\n      }\n      this.storage[key] = value\n    }\n  },\n  delete (key) {\n    try {\n      window.localStorage.removeItem(key)\n    } catch (e) {\n      if (!this.memory) {\n        console.error('setting local storage failed, falling back to in-memory storage')\n        this.memory = true\n      }\n      delete this.storage[key]\n    }\n  }\n}\n","import { getCredentials } from './auth'\nimport createEventLog from './create-event-log'\nimport createPageView from './create-page-view-log'\nimport Analytics from 'analytics'\nimport awsPinpointPlugin from '@analytics/aws-pinpoint'\n\nexport default class Amazon {\n  constructor (options) {\n    const { app = {}, fips, userPoolID } = options\n    this.analytics = Analytics({\n      app: app.name,\n      plugins: [\n        awsPinpointPlugin({\n          fips,\n          pinpointAppId: app.id,\n          getCredentials: () => {\n            return getCredentials(userPoolID, { fips })\n          }\n        })\n      ]\n    })\n\n    this.name = 'amazon'\n    Object.assign(this, options)\n  }\n\n  logPageView (page, options) {\n    const telemetryPayload = createPageView({\n      page,\n      previousPage: this.previousPage,\n      options,\n      dimensionLookup: this.dimensions,\n      metricLookup: this.metrics\n    })\n    this.previousPage = telemetryPayload.attributes\n    this.analytics.track('pageView', telemetryPayload)\n  }\n\n  logEvent (event = {}) {\n    const telemetryPayload = createEventLog({\n      event,\n      dimensionLookup: this.dimensions,\n      metricLookup: this.metrics\n    })\n    const { name } = telemetryPayload\n    this.analytics.track(name, telemetryPayload)\n  }\n}\n","/*\n(c) 2009-2013 by Jeff Mott. All rights reserved.\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\nRedistributions of source code must retain the above copyright notice, this list of conditions, and the following disclaimer.\nRedistributions in binary form must reproduce the above copyright notice, this list of conditions, and the following disclaimer in the documentation or other materials provided with the distribution.\nNeither the name CryptoJS nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS,\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE, ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\nvar CryptoJS = (function (h, s) {\n  var f = {}, g = f.lib = {}, q = function () {}, m = g.Base = {extend: function (a) { q.prototype = this; var c = new q(); a && c.mixIn(a); c.hasOwnProperty('init') || (c.init = function () { c.$super.init.apply(this, arguments) }); c.init.prototype = c; c.$super = this; return c }, create: function () { var a = this.extend(); a.init.apply(a, arguments); return a }, init: function () {}, mixIn: function (a) { for (var c in a)a.hasOwnProperty(c) && (this[c] = a[c]); a.hasOwnProperty('toString') && (this.toString = a.toString) }, clone: function () { return this.init.prototype.extend(this) }},\n    r = g.WordArray = m.extend({init: function (a, c) { a = this.words = a || []; this.sigBytes = c != s ? c : 4 * a.length }, toString: function (a) { return (a || k).stringify(this) }, concat: function (a) { var c = this.words, d = a.words, b = this.sigBytes; a = a.sigBytes; this.clamp(); if (b % 4) for (var e = 0; e < a; e++)c[b + e >>> 2] |= (d[e >>> 2] >>> 24 - 8 * (e % 4) & 255) << 24 - 8 * ((b + e) % 4); else if (d.length > 65535) for (e = 0; e < a; e += 4)c[b + e >>> 2] = d[e >>> 2]; else c.push.apply(c, d); this.sigBytes += a; return this }, clamp: function () {\n      var a = this.words, c = this.sigBytes; a[c >>> 2] &= 4294967295 <<\n32 - 8 * (c % 4); a.length = h.ceil(c / 4)\n    }, clone: function () { var a = m.clone.call(this); a.words = this.words.slice(0); return a }, random: function (a) { for (var c = [], d = 0; d < a; d += 4)c.push(4294967296 * h.random() | 0); return new r.init(c, a) }}), l = f.enc = {}, k = l.Hex = {stringify: function (a) { var c = a.words; a = a.sigBytes; for (var d = [], b = 0; b < a; b++) { var e = c[b >>> 2] >>> 24 - 8 * (b % 4) & 255; d.push((e >>> 4).toString(16)); d.push((e & 15).toString(16)) } return d.join('') }, parse: function (a) {\n      for (var c = a.length, d = [], b = 0; b < c; b += 2) {\n        d[b >>> 3] |= parseInt(a.substr(b,\n2), 16) << 24 - 4 * (b % 8)\n      } return new r.init(d, c / 2)\n    }}, n = l.Latin1 = {stringify: function (a) { var c = a.words; a = a.sigBytes; for (var d = [], b = 0; b < a; b++)d.push(String.fromCharCode(c[b >>> 2] >>> 24 - 8 * (b % 4) & 255)); return d.join('') }, parse: function (a) { for (var c = a.length, d = [], b = 0; b < c; b++)d[b >>> 2] |= (a.charCodeAt(b) & 255) << 24 - 8 * (b % 4); return new r.init(d, c) }}, j = l.Utf8 = {stringify: function (a) { try { return decodeURIComponent(escape(n.stringify(a))) } catch (c) { throw Error('Malformed UTF-8 data') } }, parse: function (a) { return n.parse(unescape(encodeURIComponent(a))) }},\n    u = g.BufferedBlockAlgorithm = m.extend({reset: function () { this._data = new r.init(); this._nDataBytes = 0 }, _append: function (a) { typeof a === 'string' && (a = j.parse(a)); this._data.concat(a); this._nDataBytes += a.sigBytes }, _process: function (a) { var c = this._data, d = c.words, b = c.sigBytes, e = this.blockSize, f = b / (4 * e), f = a ? h.ceil(f) : h.max((f | 0) - this._minBufferSize, 0); a = f * e; b = h.min(4 * a, b); if (a) { for (var g = 0; g < a; g += e) this._doProcessBlock(d, g); g = d.splice(0, a); c.sigBytes -= b } return new r.init(g, b) }, clone: function () {\n      var a = m.clone.call(this)\n      a._data = this._data.clone(); return a\n    }, _minBufferSize: 0}); g.Hasher = u.extend({cfg: m.extend(), init: function (a) { this.cfg = this.cfg.extend(a); this.reset() }, reset: function () { u.reset.call(this); this._doReset() }, update: function (a) { this._append(a); this._process(); return this }, finalize: function (a) { a && this._append(a); return this._doFinalize() }, blockSize: 16, _createHelper: function (a) { return function (c, d) { return (new a.init(d)).finalize(c) } }, _createHmacHelper: function (a) {\n      return function (c, d) {\n        return (new t.HMAC.init(a,\nd)).finalize(c)\n      }\n    }}); var t = f.algo = {}; return f\n}(Math));\n(function (h) {\n  for (var s = CryptoJS, f = s.lib, g = f.WordArray, q = f.Hasher, f = s.algo, m = [], r = [], l = function (a) { return 4294967296 * (a - (a | 0)) | 0 }, k = 2, n = 0; n < 64;) { var j; a: { j = k; for (var u = h.sqrt(j), t = 2; t <= u; t++) if (!(j % t)) { j = !1; break a }j = !0 }j && (n < 8 && (m[n] = l(h.pow(k, 0.5))), r[n] = l(h.pow(k, 1 / 3)), n++); k++ } var a = [], f = f.SHA256 = q.extend({_doReset: function () { this._hash = new g.init(m.slice(0)) }, _doProcessBlock: function (c, d) {\n      for (var b = this._hash.words, e = b[0], f = b[1], g = b[2], j = b[3], h = b[4], m = b[5], n = b[6], q = b[7], p = 0; p < 64; p++) {\n        if (p < 16) {\n          a[p] =\nc[d + p] | 0\n        } else { var k = a[p - 15], l = a[p - 2]; a[p] = ((k << 25 | k >>> 7) ^ (k << 14 | k >>> 18) ^ k >>> 3) + a[p - 7] + ((l << 15 | l >>> 17) ^ (l << 13 | l >>> 19) ^ l >>> 10) + a[p - 16] }k = q + ((h << 26 | h >>> 6) ^ (h << 21 | h >>> 11) ^ (h << 7 | h >>> 25)) + (h & m ^ ~h & n) + r[p] + a[p]; l = ((e << 30 | e >>> 2) ^ (e << 19 | e >>> 13) ^ (e << 10 | e >>> 22)) + (e & f ^ e & g ^ f & g); q = n; n = m; m = h; h = j + k | 0; j = g; g = f; f = e; e = k + l | 0\n      }b[0] = b[0] + e | 0; b[1] = b[1] + f | 0; b[2] = b[2] + g | 0; b[3] = b[3] + j | 0; b[4] = b[4] + h | 0; b[5] = b[5] + m | 0; b[6] = b[6] + n | 0; b[7] = b[7] + q | 0\n    }, _doFinalize: function () {\n      var a = this._data, d = a.words, b = 8 * this._nDataBytes, e = 8 * a.sigBytes\n      d[e >>> 5] |= 128 << 24 - e % 32; d[(e + 64 >>> 9 << 4) + 14] = h.floor(b / 4294967296); d[(e + 64 >>> 9 << 4) + 15] = b; a.sigBytes = 4 * d.length; this._process(); return this._hash\n    }, clone: function () { var a = q.clone.call(this); a._hash = this._hash.clone(); return a }}); s.SHA256 = q._createHelper(f); s.HmacSHA256 = q._createHmacHelper(f)\n})(Math);\n(function () {\n  var h = CryptoJS, s = h.enc.Utf8; h.algo.HMAC = h.lib.Base.extend({init: function (f, g) { f = this._hasher = new f.init(); typeof g === 'string' && (g = s.parse(g)); var h = f.blockSize, m = 4 * h; g.sigBytes > m && (g = f.finalize(g)); g.clamp(); for (var r = this._oKey = g.clone(), l = this._iKey = g.clone(), k = r.words, n = l.words, j = 0; j < h; j++)k[j] ^= 1549556828, n[j] ^= 909522486; r.sigBytes = l.sigBytes = m; this.reset() }, reset: function () { var f = this._hasher; f.reset(); f.update(this._iKey) }, update: function (f) { this._hasher.update(f); return this }, finalize: function (f) {\n    var g =\nthis._hasher; f = g.finalize(f); g.reset(); return g.finalize(this._oKey.clone().concat(f))\n  }})\n})()\n\nexport default CryptoJS\n","import Crypto from './crypto'\n\nexport default function (user) {\n  if (!user) return undefined\n  return Crypto.SHA256(user).toString(Crypto.enc.Hex)\n}\n","export default [\n  'esri.com',\n  'esriuk.com',\n  'esri.de',\n  'esri.ca',\n  'esrifrance.fr',\n  'esri.nl',\n  'esri-portugal.pt',\n  'esribulgaria.com',\n  'esri.fi',\n  'esri.kr',\n  'esrimalaysia.com.my',\n  'esri.es',\n  'esriaustralia.com.au',\n  'esri-southafrica.com',\n  'esri.cl',\n  'esrichina.com.cn',\n  'esri.co',\n  'esriturkey.com.tr',\n  'geodata.no',\n  'esriitalia.it',\n  'esri.pl'\n]\n","/*\n * Determines whether or not the telemetry library should be enabled based on passed in options\n */\nexport default function (options = {}) {\n  const portal = options.portal || {}\n  if (options.disabled) {\n    // Tracking is manually disabled\n    return false\n  } else if (navigator.doNotTrack === '1' || window.doNotTrack === '1') {\n    // user's browser has turned off tracking\n    return false\n  } else if (typeof portal.eueiEnabled !== 'undefined' && portal.eueiEnabled === false) {\n    // Portal does not allow tracking\n    return false\n  } else if (portal.eueiEnabled && portal.user && portal.user.orgId === portal.id) {\n    // Portal allows tracking; except when user is anonymous or doesn't belong to portal's org\n    return true\n  } else if (portal.user && !portal.user.orgId && portal.ipCntryCode === 'US') {\n    // Public user in the United States on a portal that allows tracking\n    return true\n  } else if (!portal.user && portal.ipCntryCode === 'US') {\n    // Anonymous user in the United States on a portal that allows tracking\n    return true\n  } else if (Object.keys(portal).length > 0) {\n    // Initialized with a Portal object but does not meet tracking conditions\n    return false\n  } else {\n    // Default condition not initialized with a Portal-Self object\n    return true\n  }\n}\n","import Amazon from './amazon'\nimport Google from './google'\nimport anonymize from './helpers/anonymize'\nimport internalOrgs from './helpers/internal-orgs'\nimport telemetryEnabled from './helpers/telemetry-enabled'\nimport storage from './helpers/storage'\n\nexport default class Telemetry {\n  constructor (options) {\n    // Make sure failure to init this library cannot have side-effects\n    try {\n      this.trackers = []\n      this.workflows = {}\n      this.test = options.test\n      this.debug = options.debug\n\n      this.disabled = !telemetryEnabled(options)\n      if (this.disabled) console.log('Telemetry Disabled')\n\n      if (options.portal && options.portal.user) {\n        const subscriptionInfo = options.portal.subscriptionInfo || {}\n        this.setUser(options.portal.user, subscriptionInfo.type)\n      } else if (options.user) {\n        this.setUser(options.user)\n      }\n\n      if (!this.disabled) {\n        this._initTrackers(options)\n      }\n    } catch (e) {\n      console.error('Telemetry Disabled')\n      console.error(e)\n      this.disabled = true\n    }\n  }\n\n  _initTrackers (options) {\n    if (options.amazon) {\n      const amazon = new Amazon(options.amazon)\n      this.trackers.push(amazon)\n    }\n\n    if (options.google) {\n      const google = new Google(options.google)\n      this.trackers.push(google)\n    }\n    if (!this.trackers.length) console.error(new Error('No trackers configured'))\n  }\n\n  setUser (user = {}, orgType = 'Public') {\n    user = typeof user === 'string' ? { username: user } : user\n    this.user = user\n    this.user.accountType = orgType\n    let internalDomain\n    if (user.email && user.email.split) {\n      const domain = user.email.split('@')[1]\n      internalDomain =\n        internalOrgs.filter(org => {\n          return domain === org\n        }).length > 0\n    }\n\n    if (internalDomain || ['In House', 'Demo and Marketing'].indexOf(orgType) > -1) {\n      this.user.internalUser = true\n    }\n  }\n\n  logPageView (page, options = {}) {\n    const attributes = this.preProcess(options)\n    if (this.debug) console.log('Tracking page view', JSON.stringify(attributes))\n    if (this.test && !this.disabled) return attributes\n    const trackers = this.trackers.filter(({ disabled }) => !disabled)\n\n    if (!trackers.length || this.disabled) {\n      if (!this.disabled) console.error(new Error('Page view was not logged because no trackers are configured.'))\n      return false\n    }\n\n    const promises = trackers.map(tracker => {\n      return tracker.logPageView(page, attributes)\n    })\n\n    Promise.all(promises).then()\n    return true\n  }\n\n  logEvent (options = {}) {\n    const event = this.preProcess(options)\n\n    if (this.debug) console.log('Tracking event', JSON.stringify(event))\n    if (this.test) return event\n    const trackers = this.trackers.filter(({ disabled }) => !disabled)\n\n    if (!trackers.length || this.disabled) {\n      if (!this.disabled) console.error(new Error('Event was not logged because no trackers are configured.'))\n      return false\n    }\n\n    const promises = trackers.map(tracker => {\n      return tracker.logEvent(event)\n    })\n\n    Promise.all(promises).then()\n    return true\n  }\n\n  logError (options = {}) {\n    const event = Object.assign({ eventType: 'error' }, options)\n    this.logEvent(event)\n  }\n\n  startWorkflow (name, attributes = {}) {\n    const workflow = {\n      name,\n      start: Date.now(),\n      steps: [],\n      workflowId: Math.floor((1 + Math.random()) * 0x100000000000).toString(16)\n    }\n    this._saveWorkflow(workflow)\n    const workflowObj = Object.assign({ name, step: 'start' }, attributes)\n    this._logWorkflow(workflowObj)\n    return workflow\n  }\n\n  stepWorkflow (name, step, attributes = {}) {\n    const details = typeof options === 'string' ? attributes : attributes.details\n    const workflowObj = Object.assign({ name, step, details }, attributes)\n    this._logWorkflow(workflowObj)\n  }\n\n  endWorkflow (name, attributes = {}) {\n    const workflowObj = Object.assign({ name, step: 'finish' }, attributes)\n    this._logWorkflow(workflowObj)\n  }\n\n  cancelWorkflow (name, attributes = {}) {\n    const workflowObj = Object.assign({ name, step: 'cancel' }, attributes)\n    this._logWorkflow(workflowObj)\n  }\n\n  getWorkflow (name) {\n    const workflow = storage.get(`TELEMETRY-WORKFLOW:${name}`)\n    // do not let old workflows be returned\n    if (workflow) {\n      const workflowAge = Date.now() - workflow.start\n      const timeout = 30 * 60 * 1000\n      if (workflowAge < timeout) {\n        return workflow\n      } else {\n        this._deleteWorkflow(workflow)\n      }\n    }\n  }\n\n  _saveWorkflow (workflow) {\n    storage.set(`TELEMETRY-WORKFLOW:${workflow.name}`, workflow)\n  }\n\n  _deleteWorkflow (workflow) {\n    storage.delete(`TELEMETRY-WORKFLOW:${workflow.name}`)\n  }\n\n  _logWorkflow (options = {}) {\n    /*\n    const workflow = {\n      name: 'add layer to map',\n      step: 'start',\n      details: 'some details about the step'\n    }\n    */\n    options = this.preProcess(options)\n    let workflow = this.getWorkflow(options.name)\n    if (!workflow) {\n      this.startWorkflow(options.name)\n      workflow = this.getWorkflow(options.name)\n    }\n    workflow.steps.push(options.step)\n    workflow.duration = (Date.now() - workflow.start) / 1000\n\n    if (['cancel', 'finish'].indexOf(options.step) > -1) {\n      this._deleteWorkflow(workflow)\n    } else {\n      this._saveWorkflow(workflow)\n    }\n\n    const track = Object.assign(options, {\n      eventType: 'workflow',\n      category: options.name,\n      action: options.step,\n      label: options.details,\n      duration: workflow.duration,\n      workflowId: workflow.workflowId\n    })\n\n    this.logEvent(track)\n  }\n\n  preProcess (options = {}) {\n    let userOptions = {}\n    if (this.user) {\n      userOptions = {\n        user: anonymize(this.user.username),\n        org: anonymize(this.user.orgId),\n        lastLogin: this.user.lastLogin,\n        userSince: this.user.created,\n        internalUser: this.user.internalUser || false,\n        accountType: this.user.accountType\n      }\n    }\n\n    return Object.assign({}, options, userOptions)\n  }\n\n  disableTracker (trackerName) {\n    const tracker = this.trackers.find(\n      ({ name }) => name === trackerName\n    )\n    if (tracker) {\n      tracker.disabled = true\n    }\n  }\n\n  enableTracker (trackerName) {\n    const tracker = this.trackers.find(\n      ({ name }) => name === trackerName\n    )\n    if (tracker) {\n      tracker.disabled = false\n    }\n  }\n}\n"],"names":["getCredentials","IdentityPoolId","options","fipsSubdomainSuffix","fips","COGNITO_URL","cached","Storage","get","COGNITO_KEY","Date","now","Expiration","Promise","resolve","fetchOptions","JSON","stringify","fetch","then","response","ok","Error","statusText","json","IdentityId","Credentials","set","formatTelemetryAttributes","telemetryData","dimensionLookup","excludeKeys","Object","keys","filter","includes","key","map","getCustomDimensionKey","getValue","reduce","acc","value","data","undefined","toString","lookup","formatTelemetryMetrtics","metricLookup","METRICS","getCustomMetricKey","createEventLog","event","eventType","metrics","formatTelemetryMetrics","eventAttributes","document","referrer","window","location","hostname","pathname","createPageViewLog","page","previousPage","attributes","title","pageUrl","pageName","mapMetricsAndDimensions","customTelemetryData","val","getTrackers","callback","ga","getAll","log","buildPageViewObject","dimensions","standardTelemetry","mappedCustomTelemetryData","mapCustomMetricsAndDimensions","babelHelpers.extends","buildEventObject","standardTelemetryData","category","action","label","stored","localStorage","getItem","this","storage","e","parse","setItem","memory","error","removeItem","Amazon","app","userPoolID","analytics","Analytics","name","awsPinpointPlugin","id","telemetryPayload","createPageView","track","Google","pageviewObj","trackers","forEach","tracker","send","eventObject","CryptoJS","h","s","f","g","lib","q","m","Base","extend","a","prototype","c","mixIn","hasOwnProperty","init","$super","apply","arguments","create","clone","r","WordArray","words","sigBytes","length","k","concat","d","b","clamp","push","ceil","call","slice","random","l","enc","Hex","join","parseInt","substr","n","Latin1","String","fromCharCode","charCodeAt","j","Utf8","decodeURIComponent","escape","unescape","encodeURIComponent","u","BufferedBlockAlgorithm","reset","_data","_nDataBytes","_append","_process","blockSize","max","_minBufferSize","min","_doProcessBlock","splice","Hasher","cfg","_doReset","update","finalize","_doFinalize","_createHelper","_createHmacHelper","t","HMAC","algo","Math","sqrt","pow","SHA256","_hash","p","floor","HmacSHA256","_hasher","_oKey","_iKey","user","Crypto","portal","disabled","navigator","doNotTrack","eueiEnabled","orgId","ipCntryCode","workflows","test","debug","telemetryEnabled","console","subscriptionInfo","setUser","type","_initTrackers","amazon","google","orgType","username","accountType","internalDomain","email","split","domain","internalOrgs","org","indexOf","internalUser","preProcess","promises","logPageView","all","logEvent","workflow","_saveWorkflow","workflowObj","step","_logWorkflow","details","start","_deleteWorkflow","delete","getWorkflow","startWorkflow","steps","duration","workflowId","userOptions","anonymize","lastLogin","created","trackerName","find"],"mappings":"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"}